<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKX EIP-7702 Calldata 生成器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #888;
            font-size: 13px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #00d4ff;
        }

        .info-box {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 12px;
            line-height: 1.6;
        }

        .info-box code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            border-color: #00d4ff;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .input-group .hint {
            font-size: 11px;
            color: #666;
            margin-top: 6px;
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-success {
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            color: #000;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .btn-warning {
            background: linear-gradient(90deg, #f7931a, #ff6b00);
            color: #fff;
        }

        .output-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
            color: #00ff88;
            line-height: 1.5;
        }

        .output-box.empty {
            color: #666;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }

        .call-item {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .call-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .call-item-title {
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
        }

        .call-item-remove {
            background: rgba(255, 68, 68, 0.2);
            border: none;
            color: #ff4444;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-hint {
            text-align: center;
            color: #00ff88;
            font-size: 13px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .copy-hint.show {
            opacity: 1;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #888;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .quick-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .quick-buttons button {
            padding: 10px 16px;
            margin: 0;
            width: auto;
        }

        .network-select {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .network-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .network-btn.active {
            background: rgba(247, 147, 26, 0.2);
            border-color: #f7931a;
            color: #f7931a;
        }

        .step-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            color: #00d4ff;
            margin-right: 8px;
        }

        @media (max-width: 480px) {
            .network-select {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OKX EIP-7702 Calldata 生成器</h1>
            <p>生成 executeFromSelf 批量交易数据，用于转账 0 BNB/ETH 时作为备注</p>
        </div>

        <!-- 使用说明 -->
        <div class="card">
            <div class="card-title">使用说明</div>
            <div class="info-box">
                <p><span class="step-number">1</span>选择网络并配置交易（如 USDT 授权）</p>
                <p><span class="step-number">2</span>点击「生成 Calldata」生成十六进制数据</p>
                <p><span class="step-number">3</span>点击「复制」复制生成的数据</p>
                <p><span class="step-number">4</span>发送 <code>0 BNB/ETH</code> 到你自己的地址，把 calldata 粘贴到备注/Input Data 中</p>
            </div>
            <div style="font-size: 12px; color: #888;">
                <strong>OKX 合约方法:</strong> <code>executeFromSelf (0x893aa9f6)</code><br>
                <strong>功能:</strong> 在单笔交易中执行多个合约调用
            </div>
        </div>

        <!-- 网络选择 -->
        <div class="card">
            <div class="card-title">选择网络</div>
            <div class="network-select">
                <button class="network-btn active" onclick="selectNetwork(1)">ETH 主网</button>
                <button class="network-btn" onclick="selectNetwork(56)">BSC 主网</button>
                <button class="network-btn" onclick="selectNetwork(11155111)">Sepolia 测试网</button>
            </div>
            <div id="networkInfo" style="font-size: 12px; color: #888;">
                当前 USDT: <span id="currentUsdt">0xdAC17F958D2ee523a2206206994597C13D831ec7</span>
            </div>
        </div>

        <!-- Calldata 生成器 -->
        <div class="card">
            <div class="card-title">配置批量交易</div>

            <div class="quick-buttons">
                <button class="btn btn-secondary" onclick="addApproveCall()">+ USDT 授权</button>
                <button class="btn btn-secondary" onclick="addTransferCall()">+ 转账调用</button>
                <button class="btn btn-secondary" onclick="addCustomCall()">+ 自定义调用</button>
            </div>

            <div id="callsList">
                <!-- 动态添加的交易项 -->
            </div>

            <div class="divider"></div>

            <button class="btn btn-primary" onclick="generateCalldata()">
                生成 Calldata
            </button>

            <div class="input-group">
                <label>生成的 executeFromSelf Calldata (复制此数据作为转账备注)</label>
                <div class="output-box empty" id="calldataOutput">
                    添加交易后点击「生成 Calldata」
                </div>
            </div>

            <button class="btn btn-success" onclick="copyCalldata()">
                复制 Calldata
            </button>
            <div class="copy-hint" id="copyHint">已复制到剪贴板!</div>
        </div>

        <!-- 快速生成器 - USDT 授权 -->
        <div class="card">
            <div class="card-title">快速生成 - USDT 无限授权</div>
            <p style="color: #888; font-size: 12px; margin-bottom: 16px;">
                一键生成 USDT 授权的 executeFromSelf calldata
            </p>

            <div class="input-group">
                <label>授权给 (Spender 地址)</label>
                <input type="text" id="quickSpender" placeholder="0x...">
                <div class="hint">输入你要授权 USDT 的目标地址</div>
            </div>

            <button class="btn btn-warning" onclick="quickGenerateApprove()">
                快速生成授权 Calldata
            </button>

            <div class="input-group">
                <label>生成的 Calldata</label>
                <div class="output-box empty" id="quickOutput">
                    输入 Spender 地址后点击生成
                </div>
            </div>

            <button class="btn btn-success" onclick="copyQuickCalldata()">
                复制
            </button>
            <div class="copy-hint" id="quickCopyHint">已复制到剪贴板!</div>
        </div>

        <!-- 解码器 -->
        <div class="card">
            <div class="card-title">Calldata 解码器</div>
            <p style="color: #888; font-size: 12px; margin-bottom: 16px;">
                粘贴 calldata 查看其中包含的操作
            </p>

            <div class="input-group">
                <label>输入 Calldata</label>
                <textarea id="decodeInput" placeholder="0x893aa9f6..."></textarea>
            </div>

            <button class="btn btn-secondary" onclick="decodeCalldata()">
                解码
            </button>

            <div class="output-box empty" id="decodeOutput" style="color: #fff;">
                粘贴 calldata 后点击解码
            </div>
        </div>
    </div>

    <script>
        // ==================== 常量配置 ====================

        // 函数选择器
        const EXECUTE_FROM_SELF_SELECTOR = '0x893aa9f6';  // executeFromSelf(Call[])
        const APPROVE_SELECTOR = '0x095ea7b3';  // approve(address,uint256)
        const TRANSFER_SELECTOR = '0xa9059cbb';  // transfer(address,uint256)

        // 代币合约地址
        const TOKENS = {
            1: {  // Ethereum Mainnet
                USDT: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                decimals: 6,
                native: 'ETH'
            },
            56: {  // BSC Mainnet
                USDT: '0x55d398326f99059fF775485246999027B3197955',
                decimals: 18,
                native: 'BNB'
            },
            11155111: {  // Sepolia
                USDT: '0x7169D38820dfd117C3FA1f22a697dBA58d90BA06',
                decimals: 6,
                native: 'ETH'
            }
        };

        // ==================== 全局变量 ====================

        let currentChainId = 1;
        let calls = [];
        let callIdCounter = 0;

        // ==================== 工具函数 ====================

        function toBytes32(value) {
            const hex = BigInt(value).toString(16);
            return hex.padStart(64, '0');
        }

        function addressToBytes32(address) {
            return address.toLowerCase().replace('0x', '').padStart(64, '0');
        }

        function getTokenInfo() {
            return TOKENS[currentChainId] || TOKENS[1];
        }

        // ==================== 网络选择 ====================

        function selectNetwork(chainId) {
            currentChainId = chainId;

            // 更新按钮状态
            document.querySelectorAll('.network-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // 更新显示
            const tokenInfo = getTokenInfo();
            document.getElementById('currentUsdt').textContent = tokenInfo.USDT;

            // 清空交易列表
            calls = [];
            document.getElementById('callsList').innerHTML = '';
        }

        // ==================== 添加交易调用 ====================

        function addApproveCall() {
            const tokenInfo = getTokenInfo();
            const callId = callIdCounter++;

            calls.push({
                id: callId,
                type: 'approve',
                target: tokenInfo.USDT,
                spender: '',
                amount: 'max'
            });

            const callHtml = `
                <div class="call-item" id="call-${callId}">
                    <div class="call-item-header">
                        <span class="call-item-title">USDT 授权</span>
                        <button class="call-item-remove" onclick="removeCall(${callId})">删除</button>
                    </div>
                    <div class="input-group">
                        <label>USDT 合约</label>
                        <input type="text" value="${tokenInfo.USDT}" disabled style="opacity: 0.7;">
                    </div>
                    <div class="input-group">
                        <label>授权给 (Spender)</label>
                        <input type="text" id="approve-spender-${callId}" placeholder="0x..." oninput="updateCall(${callId})">
                    </div>
                    <div class="input-group">
                        <label>授权数量</label>
                        <select id="approve-amount-${callId}" onchange="updateCall(${callId}); toggleCustomAmount(${callId})">
                            <option value="max">无限授权 (MaxUint256)</option>
                            <option value="custom">自定义数量</option>
                        </select>
                    </div>
                    <div class="input-group hidden" id="custom-amount-group-${callId}">
                        <label>自定义数量 (USDT)</label>
                        <input type="number" id="approve-custom-${callId}" placeholder="1000" oninput="updateCall(${callId})">
                    </div>
                </div>
            `;

            document.getElementById('callsList').insertAdjacentHTML('beforeend', callHtml);
        }

        function addTransferCall() {
            const tokenInfo = getTokenInfo();
            const callId = callIdCounter++;

            calls.push({
                id: callId,
                type: 'transfer',
                target: '',
                value: '0',
                data: ''
            });

            const callHtml = `
                <div class="call-item" id="call-${callId}">
                    <div class="call-item-header">
                        <span class="call-item-title">原生币转账</span>
                        <button class="call-item-remove" onclick="removeCall(${callId})">删除</button>
                    </div>
                    <div class="input-group">
                        <label>接收地址</label>
                        <input type="text" id="transfer-to-${callId}" placeholder="0x..." oninput="updateCall(${callId})">
                    </div>
                    <div class="input-group">
                        <label>金额 (Wei)</label>
                        <input type="text" id="transfer-value-${callId}" placeholder="0" value="0" oninput="updateCall(${callId})">
                        <div class="hint">0 表示不转账原生币，仅执行数据</div>
                    </div>
                    <div class="input-group">
                        <label>附加数据 (可选)</label>
                        <textarea id="transfer-data-${callId}" placeholder="0x..." oninput="updateCall(${callId})"></textarea>
                    </div>
                </div>
            `;

            document.getElementById('callsList').insertAdjacentHTML('beforeend', callHtml);
        }

        function addCustomCall() {
            const callId = callIdCounter++;

            calls.push({
                id: callId,
                type: 'custom',
                target: '',
                value: '0',
                data: ''
            });

            const callHtml = `
                <div class="call-item" id="call-${callId}">
                    <div class="call-item-header">
                        <span class="call-item-title">自定义调用</span>
                        <button class="call-item-remove" onclick="removeCall(${callId})">删除</button>
                    </div>
                    <div class="input-group">
                        <label>目标合约地址</label>
                        <input type="text" id="custom-target-${callId}" placeholder="0x..." oninput="updateCall(${callId})">
                    </div>
                    <div class="input-group">
                        <label>发送金额 (Wei)</label>
                        <input type="text" id="custom-value-${callId}" placeholder="0" value="0" oninput="updateCall(${callId})">
                    </div>
                    <div class="input-group">
                        <label>调用数据 (Hex)</label>
                        <textarea id="custom-data-${callId}" placeholder="0x..." oninput="updateCall(${callId})"></textarea>
                    </div>
                </div>
            `;

            document.getElementById('callsList').insertAdjacentHTML('beforeend', callHtml);
        }

        function removeCall(callId) {
            calls = calls.filter(c => c.id !== callId);
            document.getElementById(`call-${callId}`).remove();
        }

        function updateCall(callId) {
            const call = calls.find(c => c.id === callId);
            if (!call) return;

            if (call.type === 'approve') {
                call.spender = document.getElementById(`approve-spender-${callId}`)?.value.trim() || '';
                call.amount = document.getElementById(`approve-amount-${callId}`)?.value || 'max';
                if (call.amount === 'custom') {
                    call.customAmount = document.getElementById(`approve-custom-${callId}`)?.value || '0';
                }
            } else if (call.type === 'transfer') {
                call.target = document.getElementById(`transfer-to-${callId}`)?.value.trim() || '';
                call.value = document.getElementById(`transfer-value-${callId}`)?.value.trim() || '0';
                call.data = document.getElementById(`transfer-data-${callId}`)?.value.trim() || '';
            } else if (call.type === 'custom') {
                call.target = document.getElementById(`custom-target-${callId}`)?.value.trim() || '';
                call.value = document.getElementById(`custom-value-${callId}`)?.value.trim() || '0';
                call.data = document.getElementById(`custom-data-${callId}`)?.value.trim() || '';
            }
        }

        function toggleCustomAmount(callId) {
            const select = document.getElementById(`approve-amount-${callId}`);
            const customGroup = document.getElementById(`custom-amount-group-${callId}`);
            if (select.value === 'custom') {
                customGroup.classList.remove('hidden');
            } else {
                customGroup.classList.add('hidden');
            }
        }

        // ==================== 生成 Calldata ====================

        function generateCalldata() {
            if (calls.length === 0) {
                alert('请先添加至少一个交易');
                return null;
            }

            // 更新所有调用数据
            calls.forEach(c => updateCall(c.id));

            const tokenInfo = getTokenInfo();

            // 编码每个调用为 (target, value, data)
            const encodedCalls = [];

            for (const call of calls) {
                let target, value, data;

                if (call.type === 'approve') {
                    if (!call.spender || !call.spender.match(/^0x[a-fA-F0-9]{40}$/)) {
                        alert('USDT 授权: 请输入有效的 Spender 地址');
                        return null;
                    }

                    target = tokenInfo.USDT;
                    value = '0';

                    // 编码 approve(address,uint256)
                    let amount;
                    if (call.amount === 'max') {
                        amount = 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';
                    } else {
                        const amountBN = BigInt(Math.floor(parseFloat(call.customAmount || '0') * Math.pow(10, tokenInfo.decimals)));
                        amount = amountBN.toString(16).padStart(64, '0');
                    }
                    data = APPROVE_SELECTOR + addressToBytes32(call.spender) + amount;

                } else if (call.type === 'transfer' || call.type === 'custom') {
                    if (!call.target || !call.target.match(/^0x[a-fA-F0-9]{40}$/)) {
                        alert('请输入有效的目标地址');
                        return null;
                    }

                    target = call.target;
                    value = call.value || '0';
                    data = call.data || '0x';
                    if (!data.startsWith('0x')) {
                        data = '0x' + data;
                    }
                }

                encodedCalls.push({ target, value, data });
            }

            // 构建 executeFromSelf calldata
            const calldata = buildExecuteFromSelfCalldata(encodedCalls);

            // 显示结果
            const output = document.getElementById('calldataOutput');
            output.textContent = calldata;
            output.classList.remove('empty');

            return calldata;
        }

        function buildExecuteFromSelfCalldata(encodedCalls) {
            // executeFromSelf(Call[] calls)
            // Call = (address target, uint256 value, bytes data)

            let calldata = EXECUTE_FROM_SELF_SELECTOR.replace('0x', '');

            // 数组偏移量 (0x20 = 32)
            calldata += toBytes32(32);

            // 数组长度
            calldata += toBytes32(encodedCalls.length);

            // 计算每个 Call 的偏移量
            let currentOffset = encodedCalls.length * 32;
            const offsets = [];
            const callDataParts = [];

            encodedCalls.forEach((call, index) => {
                offsets.push(currentOffset);

                const dataHex = call.data.replace('0x', '');
                const dataLength = dataHex.length / 2;
                const dataPadded = dataHex.length > 0
                    ? dataHex.padEnd(Math.ceil(dataHex.length / 64) * 64, '0')
                    : '';

                let callPart = '';
                callPart += addressToBytes32(call.target);  // target
                callPart += toBytes32(call.value);          // value
                callPart += toBytes32(96);                  // data offset (固定为 96 = 3 * 32)
                callPart += toBytes32(dataLength);          // data length
                if (dataPadded) {
                    callPart += dataPadded;                 // data content
                }

                callDataParts.push(callPart);

                // 计算这个 Call 的总大小
                const callSize = 128 + (dataPadded.length / 2);  // 4 * 32 + data
                currentOffset += callSize;
            });

            // 添加偏移量
            offsets.forEach(offset => {
                calldata += toBytes32(offset);
            });

            // 添加 Call 数据
            callDataParts.forEach(part => {
                calldata += part;
            });

            return '0x' + calldata;
        }

        // ==================== 快速生成 USDT 授权 ====================

        function quickGenerateApprove() {
            const spender = document.getElementById('quickSpender').value.trim();

            if (!spender || !spender.match(/^0x[a-fA-F0-9]{40}$/)) {
                alert('请输入有效的 Spender 地址');
                return;
            }

            const tokenInfo = getTokenInfo();

            // 构建单个 approve 调用
            const approveData = APPROVE_SELECTOR +
                addressToBytes32(spender) +
                'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';  // MaxUint256

            const encodedCalls = [{
                target: tokenInfo.USDT,
                value: '0',
                data: '0x' + approveData.replace('0x', '')
            }];

            const calldata = buildExecuteFromSelfCalldata(encodedCalls);

            const output = document.getElementById('quickOutput');
            output.textContent = calldata;
            output.classList.remove('empty');
        }

        // ==================== 复制功能 ====================

        function copyCalldata() {
            const calldata = document.getElementById('calldataOutput').textContent;
            if (!calldata || calldata.includes('添加交易后')) {
                alert('请先生成 Calldata');
                return;
            }

            navigator.clipboard.writeText(calldata).then(() => {
                const hint = document.getElementById('copyHint');
                hint.classList.add('show');
                setTimeout(() => hint.classList.remove('show'), 2000);
            });
        }

        function copyQuickCalldata() {
            const calldata = document.getElementById('quickOutput').textContent;
            if (!calldata || calldata.includes('输入 Spender')) {
                alert('请先生成 Calldata');
                return;
            }

            navigator.clipboard.writeText(calldata).then(() => {
                const hint = document.getElementById('quickCopyHint');
                hint.classList.add('show');
                setTimeout(() => hint.classList.remove('show'), 2000);
            });
        }

        // ==================== 解码 Calldata ====================

        function decodeCalldata() {
            const input = document.getElementById('decodeInput').value.trim();
            const output = document.getElementById('decodeOutput');

            if (!input) {
                output.textContent = '请输入 calldata';
                return;
            }

            try {
                const data = input.replace('0x', '');
                const selector = '0x' + data.slice(0, 8);

                let result = `函数选择器: ${selector}\n`;

                if (selector === EXECUTE_FROM_SELF_SELECTOR) {
                    result += `方法: executeFromSelf(Call[])\n\n`;

                    // 解析数组
                    const arrayOffset = parseInt(data.slice(8, 72), 16);
                    const arrayLength = parseInt(data.slice(72, 136), 16);

                    result += `调用数量: ${arrayLength}\n`;
                    result += `数组偏移: ${arrayOffset}\n\n`;

                    // 解析每个 Call
                    let pos = 136;  // 跳过 selector + offset + length
                    const offsets = [];

                    for (let i = 0; i < arrayLength; i++) {
                        offsets.push(parseInt(data.slice(pos, pos + 64), 16));
                        pos += 64;
                    }

                    for (let i = 0; i < arrayLength; i++) {
                        const callStart = 136 + offsets[i] * 2;
                        const target = '0x' + data.slice(callStart + 24, callStart + 64);
                        const value = parseInt(data.slice(callStart + 64, callStart + 128), 16);
                        const dataOffset = parseInt(data.slice(callStart + 128, callStart + 192), 16);
                        const dataLength = parseInt(data.slice(callStart + 192, callStart + 256), 16);
                        const callData = '0x' + data.slice(callStart + 256, callStart + 256 + dataLength * 2);

                        result += `--- Call ${i + 1} ---\n`;
                        result += `Target: ${target}\n`;
                        result += `Value: ${value} Wei\n`;
                        result += `Data: ${callData}\n`;

                        // 解析内部调用
                        if (callData.startsWith(APPROVE_SELECTOR)) {
                            const spender = '0x' + callData.slice(34, 74);
                            const amount = callData.slice(74);
                            result += `  -> approve(${spender}, ${amount === 'f'.repeat(64) ? 'MaxUint256' : parseInt(amount, 16)})\n`;
                        }

                        result += '\n';
                    }

                } else if (selector === APPROVE_SELECTOR) {
                    result += `方法: approve(address, uint256)\n`;
                    const spender = '0x' + data.slice(32, 72);
                    const amount = data.slice(72, 136);
                    result += `Spender: ${spender}\n`;
                    result += `Amount: ${amount === 'f'.repeat(64) ? 'MaxUint256 (无限)' : parseInt(amount, 16)}\n`;
                } else {
                    result += `未知方法\n`;
                    result += `数据: ${input}\n`;
                }

                output.textContent = result;
                output.classList.remove('empty');

            } catch (e) {
                output.textContent = '解码失败: ' + e.message;
            }
        }
    </script>
</body>
</html>
